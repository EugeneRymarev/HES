@if (HardwareVaults == null)
{
    <LoadingSpinner />
}
else
{
    <TableAction>
        <button class="btn btn-primary" @onclick="SynchronizeDevicesAsync">
            <span id="syncBtnSpinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
            <span>Import devices</span>
        </button>

        @if (SelectedHardwareVault != null)
        {
            <button type="button" @onclick="EditVaultRFIDAsync" class="btn btn-light border mx-2" title="Edit RFID">
                <img class="icon-btn" src="/svg/action/edit.svg" />
                Edit RFID
            </button>

            @if (SelectedHardwareVault.Status == VaultStatus.Locked)
            {
                <button type="button" @onclick="ActivateVaultAsync" class="btn btn-light border mx-2" title="Activate vault">
                    <img class="icon-btn" src="/svg/action/unlock.svg" />
                    Activate vault
                </button>
            }

            @if (SelectedHardwareVault.Status == VaultStatus.Active)
            {
                <button type="button" @onclick="SuspendVaultAsync" class="btn btn-light border mx-2" title="Suspend vault">
                    <img class="icon-btn" src="/svg/action/otp.svg" />
                    Suspend vault
                </button>
            }



            @if (SelectedHardwareVault.Status == VaultStatus.Active || SelectedHardwareVault.Status == VaultStatus.Locked || SelectedHardwareVault.Status == VaultStatus.Suspended || SelectedHardwareVault.Status == VaultStatus.Reserved)
            {
                <button type="button" @onclick="CompromisedVaultAsync" class="btn btn-light border mx-2" title="Compromised">
                    <img class="icon-btn" src="/svg/action/password.svg" />
                    Vault Is Compromised
                </button>

                @*<button type="button" class="btn btn-light border mx-2" title="Show activation code">
                    <img class="icon-btn" src="/svg/action/details.svg" />
                    Show activation code
                </button>*@
            }
        }
    </TableAction>

    <TableFilter SearchTextChanged="SearchTextChangedAsync">
        <HardVaultFilter FilterChanged="FilteredAsync" />
    </TableFilter>

    <MainTable Items="HardwareVaults" SelectedItem="@SelectedHardwareVault" SelecedItemChanged="SelectedItemChangedAsync">
        <TableHeader>
            <MainTableHeader Title="@nameof(Device.Id)"
                             SortColumn="@nameof(Device.Id)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.MAC)"
                             SortColumn="@nameof(Device.MAC)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.Battery)"
                             SortColumn="@nameof(Device.Battery)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.Firmware)"
                             SortColumn="@nameof(Device.Firmware)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="Profile"
                             SortColumn="@nameof(Device.DeviceAccessProfile.Name)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.Status)"
                             SortColumn="@nameof(Device.Status)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="Last Synced"
                             SortColumn="@nameof(Device.LastSynced)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="License Status"
                             SortColumn="@nameof(Device.LicenseStatus)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="License End Date"
                             SortColumn="@nameof(Device.LicenseEndDate)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.Employee)"
                             SortColumn="@nameof(Device.Employee.FullName)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="Company"
                             SortColumn="@nameof(Device.Employee.EmpCompany)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.Model)"
                             SortColumn="@nameof(Device.Model)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="Department"
                             SortColumn="@nameof(Device.Employee.Department)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
            <MainTableHeader Title="@nameof(Device.RFID)"
                             SortColumn="@nameof(Device.RFID)"
                             CurrentSortedColumn="@SortedColumn"
                             SortedColumnChanged="SortedColumnChangedAsync"
                             SortDirectionChanged="SortDirectionChangedAsync" />
        </TableHeader>
        <TableRow>
            <td>
                @if (context.IsOnline)
                    {
                    <span title="Conected device" class="state-connected">@context.Id</span>
                    }
                    else
                    {
                    @context.Id
                    }
            </td>
            <td>
                @context.MAC
            </td>
            <td>
                @if (context.Battery >= 30)
                    {
                    <img src="/svg/device/battery_full.svg" alt="@context.Battery" />
                    <span>@context.Battery%</span>
                    }
                    else if (context.Battery >= 15 && context.Battery <= 30)
                    {
                    <img src="/svg/device/battery_30.svg" alt="@context.Battery" />
                    <span>@context.Battery%</span>
                    }
                    else
                    {
                    <img src="/svg/device/battery_15.svg" alt="@context.Battery" />
                    <span>@context.Battery%</span>
                    }
            </td>
            <td>
                @context.Firmware
            </td>
            <td>
                @context.DeviceAccessProfile?.Name
            </td>
            <td>
                @context.Status
            </td>
            <td>
                @if (context.LastSynced != null)
                    {
                    @context.LastSynced.Value.ToLocalTime()
                    }
            </td>
            <td>
                @context.LicenseStatus
            </td>
            <td>
                @if (context.LicenseEndDate != null)
                    {
                    @context.LicenseEndDate.Value.ToShortDateString()
                    }
            </td>
            <td>
                @context.Employee?.FullName
            </td>
            <td>
                @context.Employee?.EmpCompany
            </td>
            <td>
                @context.Model
            </td>
            <td>
                @context.Employee?.Department?.Name
            </td>
            <td>
                @context.RFID
            </td>
        </TableRow>
    </MainTable>
    <Pagination CurrentPageChanged="CurrentPageChangedAsync"
                DisplayRowsChanged="DisplayRowsChangedAsync"
                TotalRecords="TotalRecords"
                CurrentPage="CurrentPage"
                DisplayRows="DisplayRows"
                DisplayRecords="HardwareVaults.Count" />
}
